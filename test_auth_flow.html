<!DOCTYPE html>
<html>
<head>
    <title>Test Auth Flow</title>
</head>
<body>
    <h1>Test Authentication Flow</h1>
    
    <h2>1. Login</h2>
    <input type="email" id="email" placeholder="Email" value="admin@example.com">
    <input type="password" id="password" placeholder="Password" value="password">
    <button onclick="login()">Login</button>
    <div id="loginResult"></div>
    
    <h2>2. Get User Info</h2>
    <button onclick="getUser()">Get User</button>
    <div id="userResult"></div>
    
    <h2>3. Update Profile</h2>
    <input type="text" id="name" placeholder="Name" value="Updated Name">
    <input type="text" id="phone" placeholder="Phone" value="0123456789">
    <button onclick="updateProfile()">Update Profile</button>
    <div id="profileResult"></div>
    
    <h2>4. Get Cart</h2>
    <button onclick="getCart()">Get Cart</button>
    <div id="cartResult"></div>

    <script>
        let authToken = '';

        async function login() {
            const loginData = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/api/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(loginData)
                });
                const result = await response.json();
                document.getElementById('loginResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                
                if (result.token) {
                    authToken = result.token;
                    alert('Login successful!');
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function getUser() {
            try {
                const response = await fetch('http://127.0.0.1:8000/api/user', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken,
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.json();
                document.getElementById('userResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('userResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function updateProfile() {
            const profileData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/api/profile', {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'Bearer ' + authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profileData)
                });
                const result = await response.json();
                document.getElementById('profileResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('profileResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function getCart() {
            try {
                const response = await fetch('http://127.0.0.1:8000/api/cart', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken,
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.json();
                document.getElementById('cartResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('cartResult').innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>