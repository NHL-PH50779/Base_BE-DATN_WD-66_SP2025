<!DOCTYPE html>
<html>
<head>
    <title>Test VNPay Integration</title>
</head>
<body>
    <h1>Test VNPay Integration</h1>
    
    <h2>1. Create Order</h2>
    <button onclick="createOrder()">Create Order</button>
    <div id="orderResult"></div>
    
    <h2>2. Create VNPay Payment</h2>
    <input type="number" id="orderId" placeholder="Order ID" value="89">
    <input type="number" id="amount" placeholder="Amount" value="25020000">
    <button onclick="createVNPayPayment()">Create VNPay Payment</button>
    <div id="vnpayResult"></div>
    
    <h2>3. Test VNPay Return</h2>
    <button onclick="testVNPayReturn()">Test VNPay Return</button>
    <div id="returnResult"></div>

    <script>
        async function createOrder() {
            const orderData = {
                name: "Test User",
                phone: "0123456789",
                email: "test@example.com",
                address: "Test Address",
                payment_method: "vnpay",
                total: 25020000,
                items: [{id: 1, quantity: 1, price: "25020000"}]
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/api/orders', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(orderData)
                });
                const result = await response.json();
                document.getElementById('orderResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                if (result.data && result.data.order) {
                    document.getElementById('orderId').value = result.data.order.id;
                }
            } catch (error) {
                document.getElementById('orderResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function createVNPayPayment() {
            const orderId = document.getElementById('orderId').value;
            const amount = document.getElementById('amount').value;
            
            const paymentData = {
                order_id: parseInt(orderId),
                amount: parseInt(amount),
                order_desc: `Thanh toan don hang #${orderId}`
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/api/vnpay/create-payment', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(paymentData)
                });
                const result = await response.json();
                document.getElementById('vnpayResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                
                if (result.success && result.payment_url) {
                    const link = document.createElement('a');
                    link.href = result.payment_url;
                    link.target = '_blank';
                    link.textContent = 'Open VNPay Payment';
                    link.style.display = 'block';
                    link.style.marginTop = '10px';
                    document.getElementById('vnpayResult').appendChild(link);
                }
            } catch (error) {
                document.getElementById('vnpayResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function testVNPayReturn() {
            const orderId = document.getElementById('orderId').value || '91';
            const txnRef = orderId + '_' + Date.now();
            const url = `http://127.0.0.1:8000/api/vnpay/return?vnp_Amount=2500000000&vnp_BankCode=NCB&vnp_ResponseCode=00&vnp_TxnRef=${txnRef}&vnp_TransactionNo=15059999&vnp_PayDate=20250707035000&vnp_OrderInfo=Test+payment`;
            
            try {
                const response = await fetch(url);
                const result = await response.json();
                document.getElementById('returnResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('returnResult').innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>