<!DOCTYPE html>
<html>
<head>
    <title>Test Cart API</title>
</head>
<body>
    <h1>Test Cart API</h1>
    
    <h2>1. Login First</h2>
    <input type="email" id="email" placeholder="Email" value="test@example.com">
    <input type="password" id="password" placeholder="Password" value="password">
    <button onclick="login()">Login</button>
    <div id="loginResult"></div>
    
    <h2>2. Get Cart</h2>
    <button onclick="getCart()">Get Cart</button>
    <div id="cartResult"></div>
    
    <h2>3. Add to Cart</h2>
    <input type="number" id="productId" placeholder="Product ID" value="1">
    <input type="number" id="quantity" placeholder="Quantity" value="1">
    <button onclick="addToCart()">Add to Cart</button>
    <div id="addResult"></div>

    <script>
        let authToken = '';

        async function login() {
            const loginData = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/api/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(loginData)
                });
                const result = await response.json();
                document.getElementById('loginResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                
                if (result.access_token) {
                    authToken = result.access_token;
                    alert('Login successful!');
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function getCart() {
            try {
                const response = await fetch('http://127.0.0.1:8000/api/cart', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken,
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.json();
                document.getElementById('cartResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('cartResult').innerHTML = 'Error: ' + error.message;
            }
        }

        async function addToCart() {
            const cartData = {
                product_id: parseInt(document.getElementById('productId').value),
                quantity: parseInt(document.getElementById('quantity').value),
                price: 100000
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/api/cart', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(cartData)
                });
                const result = await response.json();
                document.getElementById('addResult').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('addResult').innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>